on:
  push:
    branches:
    - main
name: ðŸš€ Validate and deploy website on push
jobs:
  web-flow:
    name: Website Build, Validate, and Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v6
      - name: Set up Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '20'  
      - name: Install Minifier Tools
        run: npm install -g terser html-minifier csso-cli
      - name: Install Validation Tools
        run: npm install htmlhint eslint stylelint stylelint-config-standard
      - name: Minify JavaScript Files
        run: |
          if [ -f index.js ]; then
            terser index.js -o index.js --compress --mangle --comments "/eslint/"
          fi
      - name: Minify HTML Files
        run: |
          if [ -f index.html ]; then
            html-minifier --collapse-whitespace --remove-comments --minify-css true --minify-js true -o index.html index.html
          fi
      - name: Minify CSS Files
        run: |
          if [ -f styles.css ]; then
            npx csso-cli index.css --output index.css
      - name: âœ… Validate HTML
        run: npx htmlhint '*.html'
      - name: âœ… Validate JavaScript
        run: npx eslint '*.js'
      - name: âœ… Validate CSS
        run: npx stylelint '*.css'
      - name: ðŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.6
        with:
          server: ftp.cluster010.hosting.ovh.net
          username: zrenard
          password: ${{ secrets.ftp_password }}
          server-dir: /www/nanardi/
          include: |
            *.html
            *.js
            *.css
            media/**/*
